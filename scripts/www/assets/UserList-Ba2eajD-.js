import{G,c as U,d as A,t as I,r as T,J as N,h as B,K,k as O,L as X,M as z,a as o,p as q,l as F,N as L,O as J,P as M,f as Q,Q as $,w as Y,n as W,R as Z,S as ee,U as te,V as ae,z as ne,o as E,b as w,e as y,y as p,D as se,F as le,W as oe,X as ie,C as re,Y as V,E as ue}from"./index-CAWPox-O.js";import{N as ce}from"./index-DGZfK3hW.js";import{s as de}from"./function-call-CHm7p81i.js";const fe=Symbol(),he=()=>G(fe,null),[ge,D,ve]=U("list"),me={error:Boolean,offset:$(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:Q("down"),loadingText:{type:String,default:""},finishedText:String,immediateCheck:I};var Te=A({name:ge,props:me,emits:["load","update:error","update:loading"],setup(e,{emit:x,slots:s}){const i=T(e.loading),S=T(),d=T(),h=he(),n=N(S),g=q(()=>e.scroller||n.value),v=()=>{F(()=>{if(i.value||e.finished||e.disabled||e.error||(h==null?void 0:h.value)===!1)return;const{direction:u}=e,k=+e.offset,f=L(g);if(!f.height||J(S))return;let l=!1;const b=L(d);u==="up"?l=f.top-b.top<=k:l=b.bottom-f.bottom<=k,l&&(i.value=!0,x("update:loading",!0),x("load"))})},r=()=>{if(e.finished){const u=s.finished?s.finished():e.finishedText;if(u)return o("div",{class:D("finished-text")},[u])}},a=()=>{x("update:error",!1),v()},m=()=>{if(e.error){const u=s.error?s.error():e.errorText;if(u)return o("div",{role:"button",class:D("error-text"),tabindex:0,onClick:a},[u])}},_=()=>{if(i.value&&!e.finished&&!e.disabled)return o("div",{class:D("loading")},[s.loading?s.loading():e.loadingText!=null&&o(M,{class:D("loading-icon")},{default:()=>[e.loadingText||ve("loading")]})])};return B(()=>[e.loading,e.finished,e.error],v),h&&B(h,u=>{u&&v()}),K(()=>{i.value=e.loading}),O(()=>{e.immediateCheck&&v()}),X({check:v}),z("scroll",v,{target:g,passive:!0}),()=>{var u;const k=(u=s.default)==null?void 0:u.call(s),f=o("div",{ref:d,class:D("placeholder")},null);return o("div",{ref:S,role:"feed",class:D(),"aria-busy":i.value},[e.direction==="down"?k:f,_(),r(),m(),e.direction==="up"?k:f])}}});const xe=Y(Te),[Se,P,ke]=U("pull-refresh"),j=50,_e=["pulling","loosing","success"],be={disabled:Boolean,modelValue:Boolean,headHeight:$(j),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:W,successDuration:$(500),animationDuration:$(300)};var ye=A({name:Se,props:be,emits:["change","refresh","update:modelValue"],setup(e,{emit:x,slots:s}){let i;const S=T(),d=T(),h=N(S),n=Z({status:"normal",distance:0,duration:0}),g=ae(),v=()=>{if(e.headHeight!==j)return{height:`${e.headHeight}px`}},r=()=>n.status!=="loading"&&n.status!=="success"&&!e.disabled,a=t=>{const c=+(e.pullDistance||e.headHeight);return t>c&&(t<c*2?t=c+(t-c)/2:t=c*1.5+(t-c*2)/4),Math.round(t)},m=(t,c)=>{const C=+(e.pullDistance||e.headHeight);n.distance=t,c?n.status="loading":t===0?n.status="normal":t<C?n.status="pulling":n.status="loosing",x("change",{status:n.status,distance:t})},_=()=>{const{status:t}=n;return t==="normal"?"":e[`${t}Text`]||ke(t)},u=()=>{const{status:t,distance:c}=n;if(s[t])return s[t]({distance:c});const C=[];return _e.includes(t)&&C.push(o("div",{class:P("text")},[_()])),t==="loading"&&C.push(o(M,{class:P("loading")},{default:_})),C},k=()=>{n.status="success",setTimeout(()=>{m(0)},+e.successDuration)},f=t=>{i=te(h.value)===0,i&&(n.duration=0,g.start(t))},l=t=>{r()&&f(t)},b=t=>{if(r()){i||f(t);const{deltaY:c}=g;g.move(t),i&&c.value>=0&&g.isVertical()&&(ee(t),m(a(c.value)))}},H=()=>{i&&g.deltaY.value&&r()&&(n.duration=+e.animationDuration,n.status==="loosing"?(m(+e.headHeight,!0),x("update:modelValue",!0),F(()=>x("refresh"))):m(0))};return B(()=>e.modelValue,t=>{n.duration=+e.animationDuration,t?m(+e.headHeight,!0):s.success||e.successText?k():m(0,!1)}),z("touchmove",b,{target:d}),()=>{var t;const c={transitionDuration:`${n.duration}ms`,transform:n.distance?`translate3d(0,${n.distance}px, 0)`:""};return o("div",{ref:S,class:P()},[o("div",{ref:d,class:P("track"),style:c,onTouchstartPassive:l,onTouchend:H,onTouchcancel:H},[o("div",{class:P("head"),style:v()},[u()]),(t=s.default)==null?void 0:t.call(s)])])}}});const De=Y(ye),R=10,Ee={__name:"UserList",setup(e){const x=ne(),s=T([]),i=T(!1),S=T(!1),d=T(!1),h=T(1),n=async()=>{if(!(i.value&&!d.value))try{const r={page:h.value,pageSize:R},a=await V.get("/system/user/page",{params:r});console.log(a),d.value?(s.value=a.list,h.value=2):(s.value.push(...a.list),h.value++),S.value=a.list.length<R,d.value=!1}catch{d.value=!1}finally{i.value=!1}},g=r=>{x.push({path:"/user/form",query:{id:r.id}})},v=r=>{de({message:"确定删除该用户？"}).then(async()=>{await V.delete(`/system/user/delete?id= ${r}`),ue("删除成功"),s.value=s.value.filter(a=>a.id!==r)}).catch(()=>{})};return n(),(r,a)=>{const m=ce,_=se,u=re,k=xe,f=De;return E(),w("div",null,[o(m,{title:"用户管理","left-text":"返回",onClickLeft:a[0]||(a[0]=l=>r.$router.back())}),o(_,{type:"primary",size:"small",style:{margin:"10px"},onClick:a[1]||(a[1]=l=>r.$router.push("/user/form"))},{default:y(()=>[...a[4]||(a[4]=[p("新增",-1)])]),_:1}),o(f,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=l=>d.value=l),onRefresh:n},{default:y(()=>[o(k,{loading:i.value,"onUpdate:loading":a[2]||(a[2]=l=>i.value=l),finished:S.value,"finished-text":"没有更多了",onLoad:n},{default:y(()=>[(E(!0),w(le,null,oe(s.value,l=>(E(),ie(u,{key:l.id,title:l.nickname,label:l.username},{"right-icon":y(()=>[o(_,{size:"mini",type:"primary",onClick:b=>g(l)},{default:y(()=>[...a[5]||(a[5]=[p("编辑",-1)])]),_:1},8,["onClick"]),o(_,{size:"mini",type:"danger",onClick:b=>v(l.id)},{default:y(()=>[...a[6]||(a[6]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:2},1032,["title","label"]))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])])}}};export{Ee as default};
